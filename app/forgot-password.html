<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
<title>Mot de passe oubliÃ© â€” Devis App</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --orange: #F97316;
    --orange-dark: #EA6C0A;
    --orange-light: #FEF3E7;
    --orange-glow: rgba(249,115,22,0.15);
    --gray-50: #F9FAFB;
    --gray-100: #F3F4F6;
    --gray-200: #E5E7EB;
    --gray-300: #D1D5DB;
    --gray-400: #9CA3AF;
    --gray-500: #6B7280;
    --gray-600: #4B5563;
    --gray-700: #374151;
    --gray-800: #1F2937;
    --gray-900: #111827;
    --green: #10B981;
    --green-light: #D1FAE5;
    --blue: #3B82F6;
    --red: #EF4444;
    --white: #FFFFFF;
  }

  html { height: 100%; }

  body {
    font-family: 'DM Sans', sans-serif;
    min-height: 100vh; min-height: 100dvh;
    display: grid;
    grid-template-columns: 1fr 1fr;
    -webkit-font-smoothing: antialiased;
    overflow: hidden;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     LEFT PANEL
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .panel-left {
    background: var(--gray-900);
    position: relative; overflow: hidden;
    display: flex; flex-direction: column;
    justify-content: space-between;
    padding: 40px 48px;
  }
  .panel-left::before {
    content: '';
    position: absolute; inset: 0;
    background:
      radial-gradient(ellipse 580px 480px at 15% 15%, rgba(249,115,22,0.16) 0%, transparent 60%),
      radial-gradient(ellipse 380px 380px at 85% 85%, rgba(249,115,22,0.1) 0%, transparent 55%),
      radial-gradient(ellipse 280px 260px at 65% 25%, rgba(249,115,22,0.05) 0%, transparent 50%);
    pointer-events: none;
    animation: meshShift 10s ease-in-out infinite alternate;
  }
  @keyframes meshShift {
    from { transform: scale(1) rotate(0deg); }
    to   { transform: scale(1.05) rotate(1deg); }
  }
  .panel-left::after {
    content: '';
    position: absolute; inset: 0;
    background-image:
      linear-gradient(rgba(255,255,255,0.025) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255,255,255,0.025) 1px, transparent 1px);
    background-size: 52px 52px;
    pointer-events: none;
  }

  .panel-logo {
    position: relative; z-index: 1;
    display: flex; align-items: center; gap: 10px;
    text-decoration: none;
  }
  .panel-logo-icon {
    width: 38px; height: 38px; background: var(--orange);
    border-radius: 11px;
    display: flex; align-items: center; justify-content: center;
    box-shadow: 0 0 0 3px rgba(249,115,22,0.25), 0 4px 14px rgba(249,115,22,0.35);
  }
  .panel-logo-text {
    font-family: 'Syne', sans-serif; font-size: 20px; font-weight: 800;
    color: white; letter-spacing: -.03em;
  }
  .panel-logo-text em { color: var(--orange); font-style: normal; }

  .panel-content { position: relative; z-index: 1; }

  .panel-tag {
    display: inline-flex; align-items: center; gap: 7px;
    background: rgba(249,115,22,0.12); border: 1px solid rgba(249,115,22,0.22);
    color: var(--orange); font-size: 11px; font-weight: 700;
    letter-spacing: .07em; text-transform: uppercase;
    padding: 5px 13px; border-radius: 100px;
    margin-top: 16px; margin-bottom: 22px;
  }

  .panel-headline {
    font-family: 'Syne', sans-serif;
    font-size: clamp(24px, 2.8vw, 38px);
    font-weight: 800; color: white;
    line-height: 1.1; letter-spacing: -.04em; margin-bottom: 18px;
  }
  .panel-headline em { color: var(--orange); font-style: normal; }

  .panel-desc {
    font-size: 14px; color: rgba(255,255,255,0.4);
    line-height: 1.75; max-width: 320px; margin-bottom: 32px;
  }

  /* Info cards */
  .info-cards { display: flex; flex-direction: column; gap: 11px; }
  .info-card {
    display: flex; align-items: flex-start; gap: 13px;
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(255,255,255,0.06);
    border-radius: 13px; padding: 14px 16px;
    transition: background .2s;
  }
  .info-card:hover { background: rgba(255,255,255,0.07); }
  .info-card-icon {
    width: 32px; height: 32px; border-radius: 9px;
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0;
  }
  .info-card-icon.orange { background: rgba(249,115,22,0.12); border: 1px solid rgba(249,115,22,0.2); color: var(--orange); }
  .info-card-icon.green  { background: rgba(16,185,129,0.1);  border: 1px solid rgba(16,185,129,0.2); color: var(--green); }
  .info-card-icon.blue   { background: rgba(59,130,246,0.1);  border: 1px solid rgba(59,130,246,0.2); color: var(--blue); }
  .info-card-body { flex: 1; }
  .info-card-title {
    font-size: 13px; font-weight: 700;
    color: rgba(255,255,255,0.75); margin-bottom: 3px;
  }
  .info-card-desc { font-size: 11.5px; color: rgba(255,255,255,0.3); line-height: 1.5; }

  .panel-footer {
    position: relative; z-index: 1;
    padding-top: 22px;
    border-top: 1px solid rgba(255,255,255,0.07);
  }
  .back-link {
    display: inline-flex; align-items: center; gap: 8px;
    color: rgba(255,255,255,0.4); font-size: 13px; font-weight: 600;
    text-decoration: none; transition: color .2s;
  }
  .back-link:hover { color: rgba(255,255,255,0.7); }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     RIGHT PANEL
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .panel-right {
    background: var(--white);
    display: flex; align-items: center; justify-content: center;
    padding: 48px 36px;
    overflow-y: auto;
    position: relative;
  }
  .panel-right::before {
    content: '';
    position: absolute; inset: 0;
    background: radial-gradient(ellipse 500px 400px at 100% 0%, rgba(249,115,22,0.03) 0%, transparent 60%);
    pointer-events: none;
  }

  .form-wrap {
    width: 100%; max-width: 400px;
    position: relative; z-index: 1;
    animation: fadeUp .45s cubic-bezier(.4,0,.2,1) both;
  }
  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(18px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  /* Mobile logo */
  .mobile-logo {
    display: none; align-items: center; gap: 9px;
    text-decoration: none; margin-bottom: 28px;
  }
  .mobile-logo-icon {
    width: 34px; height: 34px; background: var(--orange); border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    box-shadow: 0 4px 12px rgba(249,115,22,0.32);
  }
  .mobile-logo-text {
    font-family: 'Syne', sans-serif; font-size: 18px; font-weight: 800;
    color: var(--gray-900); letter-spacing: -.03em;
  }
  .mobile-logo-text em { color: var(--orange); font-style: normal; }

  /* â”€â”€ Views (switch between: request / sent / reset) â”€â”€ */
  .view { display: none; }
  .view.active {
    display: block;
    animation: fadeUp .4s cubic-bezier(.4,0,.2,1) both;
  }

  /* Form header */
  .form-header { margin-bottom: 30px; }
  .form-badge {
    display: inline-flex; align-items: center; gap: 6px;
    background: var(--orange-light); color: var(--orange);
    font-family: 'Syne', sans-serif; font-size: 10.5px; font-weight: 700;
    letter-spacing: .08em; text-transform: uppercase;
    padding: 5px 12px; border-radius: 100px; margin-bottom: 16px;
    border: 1px solid rgba(249,115,22,0.18);
  }
  .form-title {
    font-family: 'Syne', sans-serif; font-size: 24px; font-weight: 800;
    color: var(--gray-900); letter-spacing: -.03em;
    line-height: 1.15; margin-bottom: 7px;
  }
  .form-subtitle { font-size: 14px; color: var(--gray-400); line-height: 1.65; }
  .form-subtitle strong { color: var(--gray-700); font-weight: 700; }

  /* Field */
  .field-group { display: flex; flex-direction: column; gap: 5px; margin-bottom: 14px; }
  .field-label { font-size: 12px; font-weight: 700; color: var(--gray-600); letter-spacing: .03em; }

  .input-wrap { position: relative; }
  .input-icon {
    position: absolute; left: 12px; top: 50%; transform: translateY(-50%);
    color: var(--gray-400); pointer-events: none;
    display: flex; align-items: center; transition: color .2s;
  }
  .input-wrap:focus-within .input-icon { color: var(--orange); }

  input[type="email"],
  input[type="password"] {
    width: 100%;
    border: 1.5px solid var(--gray-200); border-radius: 11px;
    padding: 12px 13px 12px 40px;
    font-family: 'DM Sans', sans-serif; font-size: 14px;
    color: var(--gray-800); background: var(--gray-50);
    transition: border-color .2s, box-shadow .2s, background .2s;
    outline: none; appearance: none; -webkit-appearance: none;
  }
  input::placeholder { color: var(--gray-300); }
  input:focus {
    border-color: var(--orange); background: var(--white);
    box-shadow: 0 0 0 3.5px rgba(249,115,22,0.1);
  }
  input.error-f { border-color: var(--red); box-shadow: 0 0 0 3px rgba(239,68,68,0.1); }
  input.valid-f { border-color: var(--green); }

  /* Toggle password */
  .toggle-pw {
    position: absolute; right: 11px; top: 50%; transform: translateY(-50%);
    background: none; border: none; cursor: pointer;
    color: var(--gray-400); padding: 4px; border-radius: 6px;
    display: flex; align-items: center; transition: all .18s;
  }
  .toggle-pw:hover { color: var(--gray-600); background: var(--gray-100); }

  /* Password strength */
  .strength-wrap { height: 3px; border-radius: 2px; background: var(--gray-100); margin-top: 6px; overflow: hidden; }
  .strength-fill { height: 100%; border-radius: 2px; transition: width .35s ease, background .35s ease; width: 0%; }
  .strength-text { font-size: 11px; color: var(--gray-400); margin-top: 4px; min-height: 15px; }

  .field-hint {
    font-size: 11.5px; color: var(--gray-400); line-height: 1.55;
    padding: 10px 13px; background: var(--gray-50); border-radius: 9px;
    border: 1px solid var(--gray-100); margin-bottom: 14px;
  }

  /* Buttons */
  .btn-primary {
    width: 100%; background: var(--orange); color: white;
    font-family: 'DM Sans', sans-serif; font-size: 15px; font-weight: 700;
    border: none; cursor: pointer; border-radius: 11px;
    padding: 13px 24px;
    transition: all .2s;
    display: flex; align-items: center; justify-content: center; gap: 8px;
    box-shadow: 0 4px 14px rgba(249,115,22,0.32);
    letter-spacing: -.01em; margin-bottom: 6px;
  }
  .btn-primary:hover:not(:disabled) {
    background: var(--orange-dark); transform: translateY(-1px);
    box-shadow: 0 7px 20px rgba(249,115,22,0.38);
  }
  .btn-primary:active:not(:disabled) { transform: translateY(0); }
  .btn-primary:disabled { opacity: .6; cursor: not-allowed; }

  .btn-primary.green {
    background: var(--green);
    box-shadow: 0 4px 14px rgba(16,185,129,0.3);
  }
  .btn-primary.green:hover:not(:disabled) {
    filter: brightness(1.06);
    box-shadow: 0 7px 20px rgba(16,185,129,0.36);
  }

  .btn-secondary-link {
    display: flex; align-items: center; justify-content: center; gap: 7px;
    font-size: 13.5px; color: var(--gray-500); font-weight: 600;
    text-decoration: none; padding: 8px; border-radius: 9px;
    transition: all .18s; margin-top: 4px;
  }
  .btn-secondary-link:hover { color: var(--gray-800); background: var(--gray-100); }

  /* Message */
  #message {
    font-size: 13px; text-align: center; border-radius: 9px;
    line-height: 1.5; max-height: 0; overflow: hidden; padding: 0;
    transition: max-height .3s ease, padding .3s ease, margin .3s ease;
  }
  #message.show { max-height: 80px; padding: 10px 14px; margin-bottom: 10px; }
  #message.success { color: var(--green); background: #F0FDF4; border: 1px solid rgba(16,185,129,0.15); }
  #message.error   { color: var(--red);   background: #FFF1F1; border: 1px solid rgba(239,68,68,0.12); }

  /* Sent screen */
  .sent-icon {
    width: 76px; height: 76px; border-radius: 50%;
    background: var(--orange-light);
    display: flex; align-items: center; justify-content: center;
    margin: 0 auto 22px;
    box-shadow: 0 0 0 10px rgba(249,115,22,0.08);
  }
  .email-badge {
    display: inline-block;
    background: var(--orange-light); color: var(--orange);
    font-weight: 700; font-size: 13px;
    padding: 4px 12px; border-radius: 8px; margin: 8px 0;
    border: 1px solid rgba(249,115,22,0.18);
    word-break: break-all;
  }
  .sent-steps {
    margin: 20px 0;
    display: flex; flex-direction: column; gap: 10px;
    text-align: left;
  }
  .sent-step {
    display: flex; align-items: center; gap: 12px;
    background: var(--gray-50); border: 1px solid var(--gray-100);
    border-radius: 10px; padding: 11px 14px;
    font-size: 13px; color: var(--gray-600); font-weight: 500;
  }
  .sent-step-num {
    width: 22px; height: 22px; border-radius: 6px;
    background: var(--orange-light); color: var(--orange);
    font-family: 'Syne', sans-serif; font-size: 11px; font-weight: 800;
    display: flex; align-items: center; justify-content: center; flex-shrink: 0;
  }

  /* Reset done screen */
  .done-icon {
    width: 76px; height: 76px; border-radius: 50%;
    background: var(--green-light);
    display: flex; align-items: center; justify-content: center;
    margin: 0 auto 22px;
    box-shadow: 0 0 0 10px rgba(16,185,129,0.1);
  }

  /* Footer */
  .form-footer {
    text-align: center; font-size: 13.5px;
    color: var(--gray-400); margin-top: 18px;
  }
  .form-footer a {
    color: var(--orange); font-weight: 700;
    text-decoration: none; transition: color .18s;
  }
  .form-footer a:hover { color: var(--orange-dark); }

  /* Spinner */
  @keyframes spin { to { transform: rotate(360deg); } }
  .spinner {
    width: 15px; height: 15px;
    border: 2px solid rgba(255,255,255,0.35);
    border-top-color: white; border-radius: 50%;
    animation: spin .65s linear infinite; flex-shrink: 0;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     RESPONSIVE
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  @media (max-width: 1024px) {
    .panel-left { padding: 32px; }
    .panel-right { padding: 36px 24px; }
  }

  @media (max-width: 768px) {
    body {
      grid-template-columns: 1fr;
      overflow-y: auto; overflow-x: hidden;
      background: var(--gray-50);
    }
    .panel-left { display: none; }
    .panel-right {
      min-height: 100dvh; padding: 40px 20px;
      background: var(--gray-50); align-items: flex-start;
    }
    .panel-right::after {
      content: '';
      position: fixed; top: 0; left: 0; right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--orange), var(--orange-dark));
    }
    .form-wrap { max-width: 100%; }
    .mobile-logo { display: flex; }
  }

  @media (max-width: 480px) {
    .panel-right { padding: 32px 16px; }
    .form-title  { font-size: 22px; }
  }

  @media (max-width: 360px) {
    .panel-right { padding: 24px 12px; }
    .form-title  { font-size: 19px; }
    input        { font-size: 13px; }
    .btn-primary { font-size: 14px; }
  }
</style>
</head>

<body>

<!-- â•â•â•â•â•â•â•â• LEFT PANEL â•â•â•â•â•â•â•â• -->
<div class="panel-left">
  <a href="../index.html" class="panel-logo">
    <div class="panel-logo-icon">
      <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5">
        <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
        <polyline points="14 2 14 8 20 8"/>
      </svg>
    </div>
    <span class="panel-logo-text">Devis<em>App</em></span>
  </a>

  <div class="panel-content">
    <div class="panel-tag">
      <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>
      RÃ©initialisation sÃ©curisÃ©e
    </div>
    <h2 class="panel-headline">Votre compte<br>reste <em>entre</em><br><em>de bonnes mains.</em></h2>
    <p class="panel-desc">Nous prenons la sÃ©curitÃ© de vos donnÃ©es au sÃ©rieux. La procÃ©dure de rÃ©initialisation est simple et rapide.</p>

    <div class="info-cards">
      <div class="info-card">
        <div class="info-card-icon orange">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
        </div>
        <div class="info-card-body">
          <div class="info-card-title">Email de rÃ©initialisation</div>
          <div class="info-card-desc">Vous recevrez un lien sÃ©curisÃ© dans votre boÃ®te mail sous quelques minutes.</div>
        </div>
      </div>
      <div class="info-card">
        <div class="info-card-icon green">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
        </div>
        <div class="info-card-body">
          <div class="info-card-title">Lien valide 1 heure</div>
          <div class="info-card-desc">Pour votre sÃ©curitÃ©, le lien expire automatiquement aprÃ¨s 60 minutes.</div>
        </div>
      </div>
      <div class="info-card">
        <div class="info-card-icon blue">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>
        </div>
        <div class="info-card-body">
          <div class="info-card-title">Nouveau mot de passe fort</div>
          <div class="info-card-desc">Choisissez un mot de passe robuste pour sÃ©curiser votre compte.</div>
        </div>
      </div>
    </div>
  </div>

  <div class="panel-footer">
    <a href="login.html" class="back-link">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="15 18 9 12 15 6"/></svg>
      Retour Ã  la connexion
    </a>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â• RIGHT PANEL â•â•â•â•â•â•â•â• -->
<div class="panel-right">
  <div class="form-wrap">

    <!-- Mobile logo -->
    <a href="../index.html" class="mobile-logo">
      <div class="mobile-logo-icon">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5">
          <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
          <polyline points="14 2 14 8 20 8"/>
        </svg>
      </div>
      <span class="mobile-logo-text">Devis<em>App</em></span>
    </a>

    <!-- â”€â”€ VIEW 1 : Request email â”€â”€ -->
    <div class="view active" id="viewRequest">
      <div class="form-header">
        <div class="form-badge">
          <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>
          Mot de passe oubliÃ©
        </div>
        <h1 class="form-title">On vous aide </h1>
        <p class="form-subtitle">Saisissez l'email associÃ© Ã  votre compte, nous vous enverrons un lien de rÃ©initialisation.</p>
      </div>

      <form id="requestForm" novalidate>
        <div class="field-group">
          <label class="field-label">Adresse email</label>
          <div class="input-wrap">
            <span class="input-icon">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                <polyline points="22,6 12,13 2,6"/>
              </svg>
            </span>
            <input id="resetEmail" type="email" placeholder="nom@entreprise.com"
                   required autocomplete="email" inputmode="email">
          </div>
        </div>

        <p id="message"></p>

        <button type="submit" id="sendBtn" class="btn-primary">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/>
          </svg>
          Envoyer le lien de rÃ©initialisation
        </button>
      </form>

      <div class="form-footer">
        Vous vous souvenez ?
        <a href="login.html">Se connecter</a>
      </div>
    </div>

    <!-- â”€â”€ VIEW 2 : Email sent â”€â”€ -->
    <div class="view" id="viewSent">
      <div class="sent-icon">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="var(--orange)" stroke-width="2">
          <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
          <polyline points="22,6 12,13 2,6"/>
        </svg>
      </div>
      <div style="text-align:center; margin-bottom: 24px;">
        <h2 class="form-title" style="text-align:center;">Email envoyÃ© ! ğŸ“¬</h2>
        <p class="form-subtitle" style="text-align:center; margin-top: 8px;">
          Un lien de rÃ©initialisation a Ã©tÃ© envoyÃ© Ã 
        </p>
        <div class="email-badge" id="sentEmail">â€”</div>
      </div>

      <div class="sent-steps">
        <div class="sent-step">
          <div class="sent-step-num">1</div>
          Ouvrez votre boÃ®te mail et cherchez un email de Devis App
        </div>
        <div class="sent-step">
          <div class="sent-step-num">2</div>
          Cliquez sur le lien dans l'email (valable 1 heure)
        </div>
        <div class="sent-step">
          <div class="sent-step-num">3</div>
          Choisissez votre nouveau mot de passe
        </div>
      </div>

      <button class="btn-primary" id="resendBtn" style="margin-top: 4px;">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/>
          <path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>
        </svg>
        Renvoyer l'email
      </button>

      <a href="login.html" class="btn-secondary-link">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
        Retour Ã  la connexion
      </a>
    </div>

    <!-- â”€â”€ VIEW 3 : New password form (token present in URL) â”€â”€ -->
    <div class="view" id="viewReset">
      <div class="form-header">
        <div class="form-badge" style="background:var(--green-light);color:var(--green);border-color:rgba(16,185,129,0.2);">
          <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>
          Nouveau mot de passe
        </div>
        <h1 class="form-title">Choisissez votre<br>nouveau mot de passe</h1>
        <p class="form-subtitle">Choisissez un mot de passe fort que vous n'utilisez pas ailleurs.</p>
      </div>

      <form id="resetForm" novalidate>
        <div class="field-group">
          <label class="field-label">Nouveau mot de passe <span style="color:var(--orange);">*</span></label>
          <div class="input-wrap">
            <span class="input-icon">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                <path d="M7 11V7a5 5 0 0110 0v4"/>
              </svg>
            </span>
            <input id="newPassword" type="password" placeholder="Min. 8 caractÃ¨res" required autocomplete="new-password">
            <button type="button" class="toggle-pw" id="toggleNew" aria-label="Afficher">
              <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
            </button>
          </div>
          <div class="strength-wrap"><div class="strength-fill" id="strengthFill"></div></div>
          <span class="strength-text" id="strengthText"></span>
        </div>

        <div class="field-group">
          <label class="field-label">Confirmer le mot de passe <span style="color:var(--orange);">*</span></label>
          <div class="input-wrap">
            <span class="input-icon">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                <path d="M7 11V7a5 5 0 0110 0v4"/>
              </svg>
            </span>
            <input id="confirmPassword" type="password" placeholder="RÃ©pÃ©tez le mot de passe" required autocomplete="new-password">
            <button type="button" class="toggle-pw" id="toggleConfirm" aria-label="Afficher">
              <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
            </button>
          </div>
        </div>

        <p class="field-hint">Min. 8 caractÃ¨res Â· majuscule Â· minuscule Â· chiffre Â· caractÃ¨re spÃ©cial (@$!%*?&)</p>

        <p id="resetMessage"></p>

        <button type="submit" id="resetBtn" class="btn-primary green">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M20 6L9 17l-5-5"/></svg>
          Enregistrer le nouveau mot de passe
        </button>
      </form>
    </div>

    <!-- â”€â”€ VIEW 4 : Reset done â”€â”€ -->
    <div class="view" id="viewDone">
      <div class="done-icon">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="var(--green)" stroke-width="2.5">
          <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/>
          <polyline points="22 4 12 14.01 9 11.01"/>
        </svg>
      </div>
      <div style="text-align:center;">
        <h2 class="form-title" style="text-align:center;">Mot de passe modifiÃ© ! ğŸ‰</h2>
        <p class="form-subtitle" style="text-align:center; margin-top:8px; margin-bottom: 28px;">
          Votre mot de passe a bien Ã©tÃ© mis Ã  jour. Vous pouvez maintenant vous connecter avec vos nouveaux identifiants.
        </p>
        <a href="login.html" class="btn-primary" style="display:inline-flex; width:100%; text-decoration:none; justify-content:center;">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <path d="M15 3h4a2 2 0 012 2v14a2 2 0 01-2 2h-4"/>
            <polyline points="10 17 15 12 10 7"/>
            <line x1="15" y1="12" x2="3" y2="12"/>
          </svg>
          Se connecter maintenant
        </a>
      </div>
    </div>

  </div><!-- /form-wrap -->
</div><!-- /panel-right -->

<script type="module">
import { createClient } from 'https://esm.sh/@supabase/supabase-js'

const supabase = createClient(
  'https://xeezdzbotsblzclnmnxg.supabase.co',
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhlZXpkemJvdHNibHpjbG5tbnhnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA0NDk3NTQsImV4cCI6MjA4NjAyNTc1NH0.RHIGavm6M9WCR6nve1Iz_JKFeQRlpRCU2FNAr9E02PM'
)

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   HELPERS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function showView(id) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'))
  document.getElementById(id).classList.add('active')
}

function showMsg(elId, text, type = 'error') {
  const el = document.getElementById(elId)
  el.textContent = text
  el.className = `${type} show`
}
function clearMsg(elId) {
  const el = document.getElementById(elId)
  el.textContent = ''; el.className = ''
}

function setLoading(btn, loading, defaultHTML) {
  btn.disabled = loading
  btn.innerHTML = loading
    ? `<span class="spinner"></span> Envoi en cours...`
    : defaultHTML
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   ROUTER â€” detect reset token
   Supabase envoie l'URL sous 2 formats :
   1. Hash: #access_token=...&type=recovery
   2. Query: ?code=...  (PKCE)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function detectResetMode() {
  const hash   = window.location.hash
  const params = new URLSearchParams(window.location.search)
  const hashParams = new URLSearchParams(hash.replace('#', ''))

  const isRecovery =
    hashParams.get('type') === 'recovery' ||
    params.get('type')     === 'recovery'  ||
    params.has('code')

  return isRecovery
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   PASSWORD STRENGTH
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function initStrength(inputId, fillId, textId) {
  const input = document.getElementById(inputId)
  const fill  = document.getElementById(fillId)
  const text  = document.getElementById(textId)
  if (!input) return

  input.addEventListener('input', () => {
    const p = input.value
    if (!p) { fill.style.width = '0%'; text.textContent = ''; return }
    let score = 0
    if (p.length >= 8)       score++
    if (/[A-Z]/.test(p))     score++
    if (/[a-z]/.test(p))     score++
    if (/\d/.test(p))        score++
    if (/[@$!%*?&]/.test(p)) score++

    const levels = [
      { w: '25%',  c: '#EF4444', l: 'TrÃ¨s faible' },
      { w: '50%',  c: '#F97316', l: 'Faible'      },
      { w: '75%',  c: '#F59E0B', l: 'Moyen'       },
      { w: '100%', c: '#10B981', l: 'Fort âœ“'      },
    ]
    const lvl = score <= 1 ? levels[0] : levels[Math.min(score - 2, 3)]
    fill.style.width      = lvl.w
    fill.style.background = lvl.c
    text.textContent      = lvl.l
    text.style.color      = lvl.c
  })
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   TOGGLE PASSWORD VISIBILITY
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function makeToggle(btnId, inputId) {
  const btn = document.getElementById(btnId)
  const inp = document.getElementById(inputId)
  if (!btn || !inp) return
  btn.addEventListener('click', () => {
    const show = inp.type === 'password'
    inp.type = show ? 'text' : 'password'
    btn.innerHTML = show
      ? `<svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19m-6.72-1.07a3 3 0 11-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>`
      : `<svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>`
  })
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   VALIDATE PASSWORD
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function validatePassword(pw) {
  if (pw.length < 8) return 'Le mot de passe doit contenir au moins 8 caractÃ¨res.'
  if (!/(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])/.test(pw))
    return 'Requis : majuscule, minuscule, chiffre et caractÃ¨re spÃ©cial.'
  return null
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   INIT
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function init() {

  // â”€â”€ Handle Supabase auth redirect (hash tokens) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // This exchanges the code/token from the URL into a real session
  const { data: { session } } = await supabase.auth.getSession()

  if (detectResetMode()) {
    // If Supabase sent a PKCE code in the URL query, exchangeCodeForSession handles it
    const code = new URLSearchParams(window.location.search).get('code')
    if (code) {
      await supabase.auth.exchangeCodeForSession(code)
    }
    showView('viewReset')
    initPasswordReset()
    return
  }

  // Normal request mode
  showView('viewRequest')
  initRequestForm()
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   VIEW 1 â€” Request reset email
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function initRequestForm() {
  const form    = document.getElementById('requestForm')
  const sendBtn = document.getElementById('sendBtn')
  let lastSentEmail = ''

  const sendDefault = `
    <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
      <line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/>
    </svg>
    Envoyer le lien de rÃ©initialisation`

  form.addEventListener('submit', async (e) => {
    e.preventDefault()
    clearMsg('message')

    const email = document.getElementById('resetEmail').value.trim()
    if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
      showMsg('message', 'Veuillez saisir une adresse email valide.')
      return
    }

    setLoading(sendBtn, true, sendDefault)

    // redirectTo doit pointer vers cette mÃªme page â€” Supabase ajoutera ?code= ou #access_token=
    const redirectTo = window.location.origin + window.location.pathname

    const { error } = await supabase.auth.resetPasswordForEmail(email, { redirectTo })

    setLoading(sendBtn, false, sendDefault)

    if (error) {
      showMsg('message', error.message || 'Erreur lors de l\'envoi. RÃ©essayez.')
      return
    }

    lastSentEmail = email
    document.getElementById('sentEmail').textContent = email
    showView('viewSent')
    initResend(lastSentEmail, redirectTo)
  })
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   VIEW 2 â€” Resend logic
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function initResend(email, redirectTo) {
  const btn = document.getElementById('resendBtn')
  let cooldown = 0
  let timer = null

  const defaultHTML = `
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
      <polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/>
      <path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>
    </svg>
    Renvoyer l'email`

  btn.addEventListener('click', async () => {
    if (cooldown > 0) return

    btn.disabled = true
    btn.innerHTML = `<span class="spinner"></span> Envoi...`

    const { error } = await supabase.auth.resetPasswordForEmail(email, { redirectTo })

    if (error) {
      btn.disabled = false
      btn.innerHTML = defaultHTML
      return
    }

    // 60s cooldown
    cooldown = 60
    const tick = () => {
      btn.innerHTML = `
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>
        </svg>
        Renvoyer dans ${cooldown}s`
      cooldown--
      if (cooldown < 0) {
        clearInterval(timer)
        btn.disabled = false
        btn.innerHTML = defaultHTML
      }
    }
    tick()
    timer = setInterval(tick, 1000)
  })
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   VIEW 3 â€” New password form
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function initPasswordReset() {
  initStrength('newPassword', 'strengthFill', 'strengthText')
  makeToggle('toggleNew', 'newPassword')
  makeToggle('toggleConfirm', 'confirmPassword')

  const form     = document.getElementById('resetForm')
  const resetBtn = document.getElementById('resetBtn')

  const defaultHTML = `
    <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
      <path d="M20 6L9 17l-5-5"/>
    </svg>
    Enregistrer le nouveau mot de passe`

  form.addEventListener('submit', async (e) => {
    e.preventDefault()
    clearMsg('resetMessage')

    const newPw  = document.getElementById('newPassword').value
    const confPw = document.getElementById('confirmPassword').value

    const pwErr = validatePassword(newPw)
    if (pwErr) { showMsg('resetMessage', pwErr); return }
    if (newPw !== confPw) { showMsg('resetMessage', 'Les mots de passe ne correspondent pas.'); return }

    setLoading(resetBtn, true, defaultHTML)

    const { error } = await supabase.auth.updateUser({ password: newPw })

    if (error) {
      let msg = error.message
      if (/session/i.test(msg) || /not authenticated/i.test(msg)) {
        msg = 'Lien expirÃ© ou invalide. Veuillez recommencer la procÃ©dure.'
      }
      showMsg('resetMessage', msg)
      setLoading(resetBtn, false, defaultHTML)
      return
    }

    // Sign out to force clean login
    await supabase.auth.signOut()
    showView('viewDone')
  })
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   LISTEN for auth state changes
   (handles hash token from email link)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
supabase.auth.onAuthStateChange((event, session) => {
  if (event === 'PASSWORD_RECOVERY') {
    showView('viewReset')
    initPasswordReset()
  }
})

init()
</script>

</body>
</html>