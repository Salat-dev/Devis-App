<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
  <title>Paramètres - Devis App</title>
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --orange: #F97316;
      --orange-dark: #EA6C0A;
      --orange-light: #FEF3E7;
      --gray-50: #F9FAFB;
      --gray-100: #F3F4F6;
      --gray-200: #E5E7EB;
      --gray-400: #9CA3AF;
      --gray-600: #4B5563;
      --gray-800: #1F2937;
      --green: #10B981;
      --red: #EF4444;
      --white: #FFFFFF;
    }

    body {
      font-family: 'DM Sans', sans-serif;
      background: var(--gray-100);
      min-height: 100vh;
      color: var(--gray-800);
      position: relative;
    }

    /* Décoration de fond similaire au login */
    body::before {
      content: ''; position: fixed; top: -100px; right: -100px; width: 400px; height: 400px;
      border-radius: 50%; background: radial-gradient(circle, rgba(249,115,22,0.06) 0%, transparent 70%);
      pointer-events: none; z-index: -1;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* Header Section */
    .header-flex {
      display: flex; justify-content: space-between; align-items: flex-end;
      margin-bottom: 32px;
    }

    .header-badge {
      display: inline-flex; align-items: center; gap: 6px;
      background: var(--orange-light); color: var(--orange);
      font-family: 'Syne', sans-serif; font-size: 11px; font-weight: 700;
      letter-spacing: 0.08em; text-transform: uppercase;
      padding: 5px 12px; border-radius: 100px; margin-bottom: 12px;
    }

    h1 {
      font-family: 'Syne', sans-serif; font-size: 32px; font-weight: 800;
      color: var(--gray-800); line-height: 1;
    }

    .back-link {
      color: var(--gray-400); text-decoration: none; font-size: 14px;
      font-weight: 600; transition: color 0.2s; display: flex; align-items: center; gap: 5px;
    }
    .back-link:hover { color: var(--orange); }

    /* Cards */
    .card {
      background: var(--white); border-radius: 24px; padding: 32px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.02), 0 20px 50px rgba(0,0,0,0.05);
      margin-bottom: 24px;
    }

    h2 {
      font-family: 'Syne', sans-serif; font-size: 18px; font-weight: 700;
      margin-bottom: 24px; display: flex; align-items: center; gap: 10px;
    }

    /* Form Grid */
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .col-span-2 { grid-column: span 2; }

    .field-group { display: flex; flex-direction: column; gap: 8px; }
    .field-group label { font-size: 12px; font-weight: 700; color: var(--gray-600); text-transform: uppercase; letter-spacing: 0.03em; }

    input, select, textarea {
      width: 100%; border: 1.5px solid var(--gray-200); border-radius: 12px;
      padding: 12px 16px; font-family: 'DM Sans', sans-serif; font-size: 14px;
      background: var(--gray-50); outline: none; transition: all 0.2s;
    }

    input:focus, select:focus, textarea:focus {
      border-color: var(--orange); background: var(--white);
      box-shadow: 0 0 0 4px rgba(249,115,22,0.1);
    }

    textarea { resize: vertical; min-height: 120px; }

    /* Button */
    .btn-save {
      background: var(--orange); color: var(--white);
      font-family: 'DM Sans', sans-serif; font-size: 16px; font-weight: 700;
      border: none; border-radius: 12px; padding: 16px 32px;
      cursor: pointer; transition: all 0.2s;
      display: inline-flex; align-items: center; gap: 10px;
      box-shadow: 0 10px 20px rgba(249,115,22,0.2);
    }

    .btn-save:hover { background: var(--orange-dark); transform: translateY(-2px); box-shadow: 0 12px 24px rgba(249,115,22,0.3); }
    .btn-save:active { transform: translateY(0); }

    #toast {
      position: fixed; bottom: 30px; right: 30px; padding: 15px 25px;
      border-radius: 12px; color: white; font-weight: 600; font-size: 14px;
      transform: translateY(100px); transition: transform 0.3s ease; z-index: 1000;
    }
    #toast.show { transform: translateY(0); }
    .toast-success { background: var(--green); }
    .toast-error { background: var(--red); }

    /* ── Responsive ── */
    @media (max-width: 768px) {
      body { padding: 24px 16px; }
      .container { max-width: 100%; }
      .header-flex { flex-direction: column; align-items: flex-start; gap: 16px; }
      .header-badge { margin-bottom: 0; }
      h1 { font-size: 28px; }
      .back-link { margin-top: 8px; font-size: 13px; }
      .card { padding: 24px; border-radius: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
      h2 { font-size: 17px; margin-bottom: 20px; }
      .grid { grid-template-columns: 1fr; gap: 16px; }
      .col-span-2 { grid-column: span 1; }
      input, select, textarea { padding: 14px 18px; font-size: 15px; border-radius: 10px; }
      .btn-save { width: 100%; padding: 16px; font-size: 15px; justify-content: center; }
      #toast { bottom: 20px; right: 20px; padding: 12px 20px; font-size: 13px; max-width: calc(100vw - 40px); }
    }

    @media (max-width: 480px) {
      body { padding: 16px 12px; }
      h1 { font-size: 24px; }
      .card { padding: 20px; border-radius: 16px; }
      h2 { font-size: 16px; margin-bottom: 16px; }
      .field-group label { font-size: 11px; }
      input, select, textarea { font-size: 14px; padding: 12px 16px; }
    }
  </style>
</head>
<body>

<div class="container">
  
  <div class="header-flex">
    <div>
      <div class="header-badge">Configuration</div>
      <h1>Paramètres</h1>
    </div>
    <a href="dashboard.html" class="back-link">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>
      Retour Dashboard
    </a>
  </div>

  <div class="card">
    <h2>Informations Entreprise</h2>

    <div class="grid">
      <div class="field-group">
        <label>Prénom</label>
        <input id="first_name" type="text" placeholder="Ex: Jean">
      </div>
      <div class="field-group">
        <label>Nom</label>
        <input id="last_name" type="text" placeholder="Ex: Dupont">
      </div>
      <div class="field-group col-span-2">
        <label>Nom de l'entreprise</label>
        <input id="company" type="text" placeholder="Ex: Studio Design Co.">
      </div>
      <div class="field-group">
        <label>Activité</label>
        <input id="activite" type="text" placeholder="Ex: Électricien, Freelance...">
      </div>
      <div class="field-group">
        <label>Téléphone</label>
        <input id="phone" type="text" placeholder="06 00 00 00 00">
      </div>
      <div class="field-group col-span-2">
        <label>Adresse complète</label>
        <input id="address" type="text" placeholder="Numéro et nom de rue">
      </div>
      <div class="field-group">
        <label>Ville</label>
        <input id="city" type="text" placeholder="Paris">
      </div>
      <div class="field-group">
        <label>Pays</label>
        <input id="country" type="text" placeholder="France">
      </div>
    </div>
  </div>

  <div class="card">
    <h2>Paramètres Facturation</h2>

    <div class="grid">
      <div class="field-group">
        <label>TVA par défaut (%)</label>
        <input id="tax_rate" type="number" step="0.01" placeholder="20">
      </div>
      <div class="field-group">
        <label>Devise</label>
        <select id="currency">
          <option value="EUR">Euro (€)</option>
          <option value="USD">Dollar ($)</option>
          <option value="XOF">FCFA (XOF)</option>
        </select>
      </div>
      <div class="field-group col-span-2">
        <label>Conditions générales de vente (CGV)</label>
        <textarea id="terms_conditions" placeholder="Saisissez vos conditions de paiement, délais..."></textarea>
      </div>
    </div>
  </div>

  <div style="display: flex; justify-content: flex-end;">
    <button onclick="saveSettings()" id="saveBtn" class="btn-save">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
      Sauvegarder les modifications
    </button>
  </div>

</div>

<div id="toast"></div>

<script type="module">
  import { createClient } from 'https://esm.sh/@supabase/supabase-js'

  const supabase = createClient(
    'https://xeezdzbotsblzclnmnxg.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhlZXpkemJvdHNibHpjbG5tbnhnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA0NDk3NTQsImV4cCI6MjA4NjAyNTc1NH0.RHIGavm6M9WCR6nve1Iz_JKFeQRlpRCU2FNAr9E02PM'
  )

  let currentUserId = null;

  function showToast(msg, type = 'success') {
    const toast = document.getElementById("toast");
    toast.textContent = msg;
    toast.className = `show toast-${type}`;
    setTimeout(() => toast.className = "", 3000);
  }

  async function init() {
    const { data: { session } } = await supabase.auth.getSession();
    if (!session) { window.location.href = "login.html"; return; }
    currentUserId = session.user.id;
    loadProfile();
  }

  async function loadProfile() {
    const { data, error } = await supabase.from("profiles").select("*").eq("id", currentUserId).single();
    if (error) return;

    document.getElementById("first_name").value = data.first_name || "";
    document.getElementById("last_name").value = data.last_name || "";
    document.getElementById("company").value = data.company || "";
    document.getElementById("activite").value = data.activite || "";
    document.getElementById("phone").value = data.phone || "";
    document.getElementById("address").value = data.address || "";
    document.getElementById("city").value = data.city || "";
    document.getElementById("country").value = data.country || "";
    document.getElementById("tax_rate").value = data.tax_rate || 20;
    document.getElementById("currency").value = data.currency || "EUR";
    document.getElementById("terms_conditions").value = data.terms_conditions || "";
  }

  window.saveSettings = async function() {
    const btn = document.getElementById("saveBtn");
    btn.disabled = true;
    btn.innerHTML = "Sauvegarde...";

    const { error } = await supabase.from("profiles").update({
      first_name: document.getElementById("first_name").value.trim(),
      last_name: document.getElementById("last_name").value.trim(),
      company: document.getElementById("company").value.trim(),
      activite: document.getElementById("activite").value.trim(),
      phone: document.getElementById("phone").value.trim(),
      address: document.getElementById("address").value.trim(),
      city: document.getElementById("city").value.trim(),
      country: document.getElementById("country").value.trim(),
      tax_rate: parseFloat(document.getElementById("tax_rate").value) || 0,
      currency: document.getElementById("currency").value,
      terms_conditions: document.getElementById("terms_conditions").value.trim()
    }).eq("id", currentUserId);

    btn.disabled = false;
    btn.innerHTML = `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg> Sauvegarder les modifications`;

    if (error) {
      showToast("Erreur lors de la sauvegarde", "error");
    } else {
      showToast("Paramètres mis à jour avec succès ✓");
    }
  }

  init();
</script>

</body>
</html>