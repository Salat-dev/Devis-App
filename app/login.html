<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
  <!-- PWA -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#F97316">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Devis App">
  <link rel="apple-touch-icon" href="/icons/icon-152x152.png">
  <link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png">
<title>Connexion — Devis App</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --orange: #F97316;
    --orange-dark: #EA6C0A;
    --orange-light: #FEF3E7;
    --orange-glow: rgba(249,115,22,0.15);
    --gray-50: #F9FAFB;
    --gray-100: #F3F4F6;
    --gray-200: #E5E7EB;
    --gray-300: #D1D5DB;
    --gray-400: #9CA3AF;
    --gray-500: #6B7280;
    --gray-600: #4B5563;
    --gray-700: #374151;
    --gray-800: #1F2937;
    --gray-900: #111827;
    --green: #10B981;
    --red: #EF4444;
    --white: #FFFFFF;
  }

  html { height: 100%; }

  body {
    font-family: 'DM Sans', sans-serif;
    min-height: 100vh;
    min-height: 100dvh;
    display: grid;
    grid-template-columns: 1fr 1fr;
    -webkit-font-smoothing: antialiased;
    overflow: hidden;
  }

  /* ══════════════════════════════
     LEFT PANEL — Decorative
  ══════════════════════════════ */
  .panel-left {
    background: var(--gray-900);
    position: relative;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    padding: 40px 48px;
  }

  /* Animated background mesh */
  .panel-left::before {
    content: '';
    position: absolute;
    inset: 0;
    background:
      radial-gradient(ellipse 600px 500px at 20% 20%, rgba(249,115,22,0.18) 0%, transparent 60%),
      radial-gradient(ellipse 400px 400px at 80% 80%, rgba(249,115,22,0.1) 0%, transparent 55%),
      radial-gradient(ellipse 300px 300px at 60% 30%, rgba(249,115,22,0.06) 0%, transparent 50%);
    pointer-events: none;
    animation: meshShift 10s ease-in-out infinite alternate;
  }
  @keyframes meshShift {
    from { transform: scale(1) rotate(0deg); }
    to   { transform: scale(1.05) rotate(1deg); }
  }

  /* Grid pattern */
  .panel-left::after {
    content: '';
    position: absolute;
    inset: 0;
    background-image:
      linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);
    background-size: 52px 52px;
    pointer-events: none;
  }

  .panel-logo {
    position: relative; z-index: 1;
    display: flex; align-items: center; gap: 10px;
    text-decoration: none;
  }
  .panel-logo-icon {
    width: 38px; height: 38px;
    background: var(--orange);
    border-radius: 11px;
    display: flex; align-items: center; justify-content: center;
    box-shadow: 0 0 0 3px rgba(249,115,22,0.25), 0 4px 14px rgba(249,115,22,0.35);
  }
  .panel-logo-text {
    font-family: 'Syne', sans-serif;
    font-size: 20px; font-weight: 800;
    color: white; letter-spacing: -.03em;
  }
  .panel-logo-text em { color: var(--orange); font-style: normal; }

  .panel-content {
    position: relative; z-index: 1;
  }

  .panel-tag {
    display: inline-flex; align-items: center; gap: 7px;
    background: rgba(249,115,22,0.12);
    border: 1px solid rgba(249,115,22,0.22);
    color: var(--orange);
    font-size: 11px; font-weight: 700;
    letter-spacing: .07em; text-transform: uppercase;
    padding: 5px 13px; border-radius: 100px;
    margin-bottom: 22px;
  }

  .panel-headline {
    font-family: 'Syne', sans-serif;
    font-size: clamp(26px, 3vw, 40px);
    font-weight: 800;
    color: white;
    line-height: 1.1;
    letter-spacing: -.04em;
    margin-bottom: 18px;
  }
  .panel-headline em { color: var(--orange); font-style: normal; }

  .panel-desc {
    font-size: 14.5px;
    color: rgba(255,255,255,0.45);
    line-height: 1.75;
    max-width: 340px;
    margin-bottom: 32px;
  }

  /* Feature pills */
  .feat-pills { display: flex; flex-direction: column; gap: 11px; }
  .feat-pill {
    display: flex; align-items: center; gap: 12px;
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(255,255,255,0.07);
    border-radius: 12px;
    padding: 12px 16px;
    backdrop-filter: blur(6px);
    transition: background .2s;
  }
  .feat-pill:hover { background: rgba(255,255,255,0.07); }
  .feat-pill-icon {
    width: 32px; height: 32px;
    border-radius: 9px;
    background: rgba(249,115,22,0.12);
    border: 1px solid rgba(249,115,22,0.2);
    display: flex; align-items: center; justify-content: center;
    color: var(--orange); flex-shrink: 0;
  }
  .feat-pill-text {
    font-size: 13.5px; font-weight: 600;
    color: rgba(255,255,255,0.7);
  }

  .panel-footer {
    position: relative; z-index: 1;
    display: flex; align-items: center; gap: 12px;
    padding-top: 24px;
    border-top: 1px solid rgba(255,255,255,0.07);
  }
  .panel-avatars { display: flex; }
  .panel-avatars span {
    width: 30px; height: 30px; border-radius: 50%;
    border: 2px solid var(--gray-900);
    background: var(--orange-light);
    display: flex; align-items: center; justify-content: center;
    font-size: 9px; font-weight: 700; color: var(--orange);
    margin-left: -8px;
  }
  .panel-avatars span:first-child { margin-left: 0; }
  .panel-footer-text { font-size: 12.5px; color: rgba(255,255,255,0.35); }
  .panel-footer-text strong { color: rgba(255,255,255,0.7); }

  /* ══════════════════════════════
     RIGHT PANEL — Form
  ══════════════════════════════ */
  .panel-right {
    background: var(--white);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 48px 32px;
    overflow-y: auto;
    position: relative;
  }

  /* Subtle background */
  .panel-right::before {
    content: '';
    position: absolute; inset: 0;
    background: radial-gradient(ellipse 500px 400px at 100% 0%, rgba(249,115,22,0.04) 0%, transparent 60%);
    pointer-events: none;
  }

  .form-wrap {
    width: 100%; max-width: 400px;
    position: relative; z-index: 1;
    animation: fadeUp .45s cubic-bezier(.4,0,.2,1) both;
  }
  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(18px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  .form-header { margin-bottom: 32px; }

  .form-badge {
    display: inline-flex; align-items: center; gap: 6px;
    background: var(--orange-light); color: var(--orange);
    font-family: 'Syne', sans-serif;
    font-size: 10.5px; font-weight: 700;
    letter-spacing: .08em; text-transform: uppercase;
    padding: 5px 12px; border-radius: 100px;
    margin-bottom: 18px;
    border: 1px solid rgba(249,115,22,0.18);
  }

  .form-title {
    font-family: 'Syne', sans-serif;
    font-size: 26px; font-weight: 800;
    color: var(--gray-900);
    letter-spacing: -.03em;
    line-height: 1.15;
    margin-bottom: 7px;
  }
  .form-subtitle {
    font-size: 14px; color: var(--gray-400);
    line-height: 1.6;
  }

  /* ─── Fields ─── */
  .field-group {
    display: flex; flex-direction: column; gap: 6px;
    margin-bottom: 14px;
  }
  .field-label {
    font-size: 12px; font-weight: 700;
    color: var(--gray-600); letter-spacing: .03em;
    display: flex; align-items: center; justify-content: space-between;
  }
  .field-label a {
    font-size: 11.5px; color: var(--orange);
    text-decoration: none; font-weight: 600;
    transition: color .18s;
  }
  .field-label a:hover { color: var(--orange-dark); }

  .input-wrap {
    position: relative;
  }
  .input-icon {
    position: absolute; left: 13px; top: 50%;
    transform: translateY(-50%);
    color: var(--gray-400); pointer-events: none;
    transition: color .2s;
    display: flex; align-items: center;
  }
  .input-wrap:focus-within .input-icon { color: var(--orange); }

  input[type="email"],
  input[type="password"],
  input[type="text"] {
    width: 100%;
    border: 1.5px solid var(--gray-200);
    border-radius: 11px;
    padding: 12px 14px 12px 42px;
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    color: var(--gray-800);
    background: var(--gray-50);
    transition: border-color .2s, box-shadow .2s, background .2s;
    outline: none;
    -webkit-appearance: none;
    appearance: none;
  }
  input::placeholder { color: var(--gray-300); }
  input:focus {
    border-color: var(--orange);
    background: var(--white);
    box-shadow: 0 0 0 3.5px rgba(249,115,22,0.1);
  }
  input.error-field {
    border-color: var(--red);
    box-shadow: 0 0 0 3px rgba(239,68,68,0.1);
  }
  input.valid-field {
    border-color: var(--green);
  }

  /* Password toggle */
  .toggle-pw {
    position: absolute; right: 12px; top: 50%;
    transform: translateY(-50%);
    background: none; border: none; cursor: pointer;
    color: var(--gray-400); padding: 4px;
    border-radius: 6px; display: flex; align-items: center;
    transition: all .18s;
  }
  .toggle-pw:hover { color: var(--gray-600); background: var(--gray-100); }

  /* Strength bar */
  .strength-bar {
    height: 3px; border-radius: 2px;
    background: var(--gray-100);
    margin-top: 7px; overflow: hidden;
    display: none;
  }
  .strength-fill {
    height: 100%; border-radius: 2px;
    transition: width .3s ease, background .3s ease;
    width: 0%;
  }

  /* ─── Submit ─── */
  .btn-submit {
    width: 100%;
    background: var(--orange); color: white;
    font-family: 'DM Sans', sans-serif;
    font-size: 15px; font-weight: 700;
    border: none; cursor: pointer;
    border-radius: 11px;
    padding: 13px 24px;
    transition: all .2s;
    display: flex; align-items: center; justify-content: center; gap: 8px;
    box-shadow: 0 4px 14px rgba(249,115,22,0.32), 0 1px 3px rgba(249,115,22,0.2);
    margin-top: 8px; margin-bottom: 6px;
    letter-spacing: -.01em;
  }
  .btn-submit:hover:not(:disabled) {
    background: var(--orange-dark);
    transform: translateY(-1px);
    box-shadow: 0 7px 20px rgba(249,115,22,0.38), 0 1px 4px rgba(249,115,22,0.2);
  }
  .btn-submit:active:not(:disabled) { transform: translateY(0); }
  .btn-submit:disabled { opacity: .6; cursor: not-allowed; }

  /* ─── Message ─── */
  #message {
    font-size: 13px; text-align: center;
    min-height: 0; border-radius: 9px;
    padding: 0; line-height: 1.5;
    overflow: hidden; max-height: 0;
    transition: max-height .3s ease, padding .3s ease, margin .3s ease;
    margin-bottom: 0;
  }
  #message.show {
    max-height: 80px; padding: 10px 14px;
    margin-bottom: 6px;
  }
  #message.success { color: var(--green); background: #F0FDF4; border: 1px solid rgba(16,185,129,0.15); }
  #message.error   { color: var(--red);   background: #FFF1F1; border: 1px solid rgba(239,68,68,0.15); }

  /* ─── Divider ─── */
  .divider {
    display: flex; align-items: center; gap: 12px;
    margin: 20px 0;
  }
  .divider::before, .divider::after { content: ''; flex: 1; height: 1px; background: var(--gray-100); }
  .divider span { font-size: 12px; color: var(--gray-300); font-weight: 600; white-space: nowrap; }

  /* ─── Footer ─── */
  .form-footer {
    text-align: center;
    font-size: 13.5px; color: var(--gray-400);
  }
  .form-footer a {
    color: var(--orange); font-weight: 700;
    text-decoration: none; transition: color .18s;
  }
  .form-footer a:hover { color: var(--orange-dark); }

  /* ─── Trust row ─── */
  .trust-row {
    display: flex; align-items: center; justify-content: center;
    gap: 16px; margin-top: 18px; flex-wrap: wrap;
  }
  .trust-item {
    display: flex; align-items: center; gap: 5px;
    font-size: 11.5px; color: var(--gray-300); font-weight: 500;
  }
  .trust-item svg { color: var(--green); }

  /* ─── Spinner ─── */
  @keyframes spin { to { transform: rotate(360deg); } }
  .spinner {
    width: 16px; height: 16px;
    border: 2px solid rgba(255,255,255,0.35);
    border-top-color: white;
    border-radius: 50%;
    animation: spin .65s linear infinite;
    flex-shrink: 0;
  }

  /* ══════════════════════════════
     RESPONSIVE
  ══════════════════════════════ */

  /* Tablet landscape: show panel with less padding */
  @media (max-width: 1024px) {
    .panel-left { padding: 32px; }
    .panel-headline { font-size: 28px; }
    .panel-right { padding: 36px 24px; }
  }

  /* Tablet portrait: hide decorative panel */
  @media (max-width: 768px) {
    body {
      grid-template-columns: 1fr;
      overflow-y: auto;
      overflow-x: hidden;
      background: var(--gray-50);
    }

    .panel-left { display: none; }

    .panel-right {
      min-height: 100dvh;
      padding: 40px 20px;
      background: var(--gray-50);
      align-items: flex-start;
      padding-top: 48px;
    }

    /* Subtle top accent */
    .panel-right::after {
      content: '';
      position: fixed; top: 0; left: 0; right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--orange), var(--orange-dark));
    }

    .form-wrap {
      max-width: 100%;
      width: 100%;
    }

    /* Add a mini logo on mobile */
    .mobile-logo {
      display: flex !important;
    }

    .form-header { margin-bottom: 28px; }
  }

  /* Small mobile */
  @media (max-width: 480px) {
    .panel-right { padding: 36px 16px; }
    .form-title  { font-size: 22px; }
    .trust-row   { gap: 12px; }
  }

  /* Very small mobile */
  @media (max-width: 360px) {
    .panel-right { padding: 28px 12px; }
    .form-title  { font-size: 20px; }
    input        { font-size: 13px; }
    .btn-submit  { font-size: 14px; }
    .trust-row   { display: none; }
  }

  /* Mobile logo (hidden on desktop) */
  .mobile-logo {
    display: none;
    align-items: center; gap: 9px;
    text-decoration: none; margin-bottom: 28px;
  }
  .mobile-logo-icon {
    width: 34px; height: 34px; background: var(--orange); border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    box-shadow: 0 4px 12px rgba(249,115,22,0.32);
  }
  .mobile-logo-text {
    font-family: 'Syne', sans-serif; font-size: 18px; font-weight: 800;
    color: var(--gray-900); letter-spacing: -.03em;
  }
  .mobile-logo-text em { color: var(--orange); font-style: normal; }
</style>
</head>

<body>

<!-- ════════ LEFT PANEL ════════ -->
<div class="panel-left">
  <a href="../index.html" class="panel-logo">
    <div class="panel-logo-icon">
      <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5">
        <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
        <polyline points="14 2 14 8 20 8"/>
      </svg>
    </div>
    <span class="panel-logo-text">Devis<em>App</em></span>
  </a>

  <div class="panel-content">
    <div class="panel-tag">
      <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
      Facturation simplifiée
    </div>
    <h2 class="panel-headline">Reprenez le<br>contrôle de votre<br><em>facturation.</em></h2>
    <p class="panel-desc">Créez des devis professionnels, gérez vos clients et suivez vos paiements — le tout en quelques minutes.</p>

    <div class="feat-pills">
      <div class="feat-pill">
        <div class="feat-pill-icon">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
        </div>
        <span class="feat-pill-text">Devis PDF professionnels en 3 min</span>
      </div>
      <div class="feat-pill">
        <div class="feat-pill-icon">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>
        </div>
        <span class="feat-pill-text">Envoi direct via WhatsApp & Email</span>
      </div>
      <div class="feat-pill">
        <div class="feat-pill-icon">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
        </div>
        <span class="feat-pill-text">Tableau de bord & suivi en temps réel</span>
      </div>
    </div>
  </div>

  <div class="panel-footer">
    <div class="panel-avatars">
      <span>KD</span><span>ML</span><span>AB</span><span>SF</span>
    </div>
    <p class="panel-footer-text"><strong>+2 400 entrepreneurs</strong> nous font confiance</p>
  </div>
</div>

<!-- ════════ RIGHT PANEL ════════ -->
<div class="panel-right">
  <div class="form-wrap">

    <!-- Mobile logo only -->
    <a href="../index.html" class="mobile-logo">
      <div class="mobile-logo-icon">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5">
          <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
          <polyline points="14 2 14 8 20 8"/>
        </svg>
      </div>
      <span class="mobile-logo-text">Devis<em>App</em></span>
    </a>

    <div class="form-header">
      <div class="form-badge">
        <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
          <polyline points="14 2 14 8 20 8"/>
        </svg>
        Connexion sécurisée
      </div>
      <h1 class="form-title">Bon retour ! </h1>
      <p class="form-subtitle">Connectez-vous pour gérer vos devis et clients.</p>
    </div>

    <form id="loginForm" novalidate>

      <div class="field-group">
        <label class="field-label">Adresse email</label>
        <div class="input-wrap">
          <span class="input-icon">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
              <polyline points="22,6 12,13 2,6"/>
            </svg>
          </span>
          <input id="email" type="email" placeholder="nom@entreprise.com" required autocomplete="email" inputmode="email">
        </div>
      </div>

      <div class="field-group">
        <label class="field-label">
          Mot de passe
          <a href="forgot-password.html">Mot de passe oublié ?</a>
        </label>
        <div class="input-wrap">
          <span class="input-icon">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
              <path d="M7 11V7a5 5 0 0110 0v4"/>
            </svg>
          </span>
          <input id="password" type="password" placeholder="••••••••" required autocomplete="current-password">
          <button type="button" class="toggle-pw" id="togglePw" aria-label="Afficher le mot de passe">
            <svg id="eyeIcon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
              <circle cx="12" cy="12" r="3"/>
            </svg>
          </button>
        </div>
      </div>

      <!-- Message -->
      <p id="message"></p>

      <button type="submit" id="loginBtn" class="btn-submit">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <path d="M15 3h4a2 2 0 012 2v14a2 2 0 01-2 2h-4"/>
          <polyline points="10 17 15 12 10 7"/>
          <line x1="15" y1="12" x2="3" y2="12"/>
        </svg>
        Se connecter
      </button>

    </form>

    <!-- Trust indicators -->
    <div class="trust-row">
      <div class="trust-item">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>
        Connexion chiffrée SSL
      </div>
      <div class="trust-item">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M22 11.08V12a10 10 0 11-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
        Données sécurisées
      </div>
      <div class="trust-item">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
        RGPD conforme
      </div>
    </div>

    <div class="divider"><span>Pas encore de compte ?</span></div>

    <div class="form-footer">
      <a href="register.html" style="display:inline-flex;align-items:center;gap:7px;background:var(--gray-50);border:1.5px solid var(--gray-200);color:var(--gray-700);font-weight:600;font-size:14px;padding:11px 20px;border-radius:11px;text-decoration:none;width:100%;justify-content:center;transition:all .2s;" onmouseover="this.style.borderColor='var(--orange)';this.style.color='var(--orange)';this.style.background='var(--orange-light)'" onmouseout="this.style.borderColor='var(--gray-200)';this.style.color='var(--gray-700)';this.style.background='var(--gray-50)'">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M16 21v-2a4 4 0 00-4-4H6a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" y1="8" x2="19" y2="14"/><line x1="22" y1="11" x2="16" y2="11"/></svg>
        Créer un compte gratuitement
      </a>
    </div>

  </div>
</div>

<script type="module">
import { createClient } from 'https://esm.sh/@supabase/supabase-js'

const supabase = createClient(
  'https://xeezdzbotsblzclnmnxg.supabase.co',
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhlZXpkemJvdHNibHpjbG5tbnhnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA0NDk3NTQsImV4cCI6MjA4NjAyNTc1NH0.RHIGavm6M9WCR6nve1Iz_JKFeQRlpRCU2FNAr9E02PM'
)

const loginForm   = document.getElementById('loginForm')
const loginBtn    = document.getElementById('loginBtn')
const messageEl   = document.getElementById('message')
const toggleBtn   = document.getElementById('togglePw')
const passwordInput = document.getElementById('password')
const emailInput    = document.getElementById('email')

/* ─── Toggle password visibility ─── */
toggleBtn.addEventListener('click', () => {
  const show = passwordInput.type === 'password'
  passwordInput.type = show ? 'text' : 'password'
  toggleBtn.innerHTML = show
    ? `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19m-6.72-1.07a3 3 0 11-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>`
    : `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>`
})

/* ─── Inline email validation ─── */
emailInput.addEventListener('blur', () => {
  const v = emailInput.value.trim()
  if (v && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v)) {
    emailInput.classList.add('error-field')
  } else if (v) {
    emailInput.classList.remove('error-field')
    emailInput.classList.add('valid-field')
  }
})
emailInput.addEventListener('input', () => {
  emailInput.classList.remove('error-field', 'valid-field')
})

/* ─── Messages ─── */
function showMessage(text, type = 'error') {
  messageEl.textContent = text
  messageEl.className = `${type} show`
}
function clearMessage() {
  messageEl.textContent = ''
  messageEl.className = ''
}

function setLoading(loading) {
  loginBtn.disabled = loading
  loginBtn.innerHTML = loading
    ? `<span class="spinner"></span> Connexion en cours...`
    : `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M15 3h4a2 2 0 012 2v14a2 2 0 01-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg> Se connecter`
}

/* ─── Sync pending profile ─── */
async function syncPendingProfile(userId) {
  try {
    const pending = localStorage.getItem('pending_profile')
    if (!pending) return
    const { id, ...profileData } = JSON.parse(pending)
    const { error } = await supabase.from('profiles').update(profileData).eq('id', userId)
    if (!error) localStorage.removeItem('pending_profile')
  } catch { localStorage.removeItem('pending_profile') }
}

/* ─── Form submit ─── */
loginForm.addEventListener('submit', async (e) => {
  e.preventDefault()
  clearMessage()

  const email    = emailInput.value.trim()
  const password = passwordInput.value

  if (!email || !password) {
    showMessage('Veuillez remplir tous les champs.')
    return
  }

  setLoading(true)

  const { data, error } = await supabase.auth.signInWithPassword({ email, password })

  if (error) {
    const msg = error.message.toLowerCase()
    let friendly = 'Erreur de connexion.'
    if (msg.includes('invalid login') || msg.includes('invalid credentials')) {
      friendly = 'Email ou mot de passe incorrect.'
    } else if (msg.includes('email not confirmed')) {
      friendly = 'Email non confirmé. Vérifiez votre boîte mail et cliquez sur le lien d\'activation.'
    } else if (msg.includes('too many requests')) {
      friendly = 'Trop de tentatives. Réessayez dans quelques minutes.'
    } else {
      friendly = error.message
    }
    showMessage(friendly)
    setLoading(false)
    return
  }

  showMessage('Connexion réussie ! Redirection...', 'success')
  if (data.user) await syncPendingProfile(data.user.id)
  setTimeout(() => { window.location.href = 'dashboard.html' }, 1100)
})
</script>


  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', async () => {
        try {
          const reg = await navigator.serviceWorker.register('/sw.js', { scope: '/' })
          reg.addEventListener('updatefound', () => {
            const nw = reg.installing
            nw.addEventListener('statechange', () => {
              if (nw.state === 'installed' && navigator.serviceWorker.controller) {
                showPWAUpdate()
              }
            })
          })
        } catch(e) { console.warn('[SW]', e) }
      })
    }
    function showPWAUpdate() {
      const b = document.createElement('div')
      b.id = 'pwa-banner'
      b.innerHTML = `<div style="position:fixed;bottom:80px;left:50%;transform:translateX(-50%);background:#1F2937;color:white;border-radius:14px;padding:13px 18px;display:flex;align-items:center;gap:12px;box-shadow:0 8px 32px rgba(0,0,0,.3);z-index:9999;font-family:'DM Sans',sans-serif;font-size:13px;font-weight:500;white-space:nowrap;border:1px solid rgba(255,255,255,.08);">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#F97316" stroke-width="2.5"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
        Mise à jour disponible
        <button onclick="navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage('SKIP_WAITING');location.reload()" style="background:#F97316;color:white;border:none;border-radius:8px;padding:6px 13px;font-family:inherit;font-size:12px;font-weight:700;cursor:pointer;">Actualiser</button>
        <button onclick="document.getElementById('pwa-banner').remove()" style="background:none;border:none;color:rgba(255,255,255,.4);cursor:pointer;font-size:18px;line-height:1;padding:0 2px;">×</button>
      </div>`
      document.body.appendChild(b)
    }
    let _deferredPrompt = null
    window.addEventListener('beforeinstallprompt', e => { e.preventDefault(); _deferredPrompt = e })
    window.installPWA = async () => {
      if (!_deferredPrompt) return
      _deferredPrompt.prompt()
      await _deferredPrompt.userChoice
      _deferredPrompt = null
    }
  </script>
</body>
</html>